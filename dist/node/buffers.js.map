{"version":3,"sources":["buffers.js"],"names":[],"mappings":"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","file":"buffers.js","sourcesContent":["\n//\n// TODO: this isn't idiomatically javascript (could probably use slice/splice to good effect)\n//\nfunction acopy(src, srcStart, dest, destStart, length) {\n  for(let i = 0; i < length; i += 1) {\n    dest[i + destStart] = src[i + srcStart];\n  }\n}\n\n// --------------------------------------------------------------------------\n\nclass RingBuffer {\n  constructor(s) {\n    let size = (typeof s === 'number') ? Math.max(1, s) : 1;\n    this._tail   = 0;\n    this._head   = 0;\n    this._length = 0;\n    this._values = new Array(size);\n  }\n\n  pop() {\n    let result;\n    if(this.length) {\n      // Get the item out of the set of values\n      result = (this._values[this._tail] !== null) ? this._values[this._tail] : null;\n\n      // Remove the item from the set of values, update indicies\n      this._values[this._tail] = null;\n      this._tail = (this._tail + 1) % this._values.length;\n      this._length -= 1;\n    } else {\n      result = null;\n    }\n    return result;\n  }\n\n  unshift(val) {\n    this._values[this._head] = val;\n    this._head = (this._head + 1) % this._values.length;\n    this._length += 1;\n  }\n\n  resizingUnshift(val) {\n    if(this.length + 1 === this._values.length) {\n      this.resize();\n    }\n    this.unshift(val);\n  }\n\n  resize() {\n    let newArry = new Array(this._values.length * 2);\n\n    if(this._tail < this._head) {\n      acopy(this._values, this._tail, newArry, 0, this._head);\n\n      this._tail = 0;\n      this._head = this.length;\n      this._values = newArry;\n\n    } else if(this._head < this._tail) {\n      acopy(this._values, 0, newArry, this._values.length - this._tail, this._head);\n\n      this._tail = 0;\n      this._head = this.length;\n      this._values = newArry;\n\n    } else {\n      this._tail = 0;\n      this._head = 0;\n      this._values = newArry;\n    }\n  }\n\n  cleanup(keep) {\n    for(let i = 0, l = this.length; i < l; i += 1) {\n      let item = this.pop();\n\n      if(keep(item)) {\n        this.unshift(item);\n      }\n    }\n  }\n\n  get length() {\n    return this._length;\n  }\n}\n\n// --------------------------------------------------------------------------\n\nclass FixedBuffer {\n  constructor(n) {\n    this._buf = new RingBuffer(n);\n    this._size = n;\n  }\n\n  remove() {\n    return this._buf.pop();\n  }\n\n  add(v) {\n    if(this.full) {\n      throw new Error(\"Cannot add to a full buffer.\");\n    }\n    this._buf.resizingUnshift(v);\n\n    return this;\n  }\n\n  get length() {\n    return this._buf.length;\n  }\n\n  get full() {\n    return this._buf.length === this._size;\n  }\n}\n\n// --------------------------------------------------------------------------\n\nclass DroppingBuffer extends FixedBuffer {\n  add(v) {\n    if(this._buf.length < this._size) {\n      this._buf.unshift(v);\n    }\n\n    return this;\n  }\n\n  get full() {\n    return false;\n  }\n}\n\n// --------------------------------------------------------------------------\n\nclass SlidingBuffer extends FixedBuffer {\n  add(v) {\n    if(this._buf.length === this._size) {\n      this.remove();\n    }\n    this._buf.unshift(v);\n\n    return this;\n  }\n\n  get full() {\n    return false;\n  }\n}\n\nexport { DroppingBuffer, SlidingBuffer, FixedBuffer, RingBuffer };"],"sourceRoot":"/source/"}